<div class="form-dialog-header">
  <div class="form-dialog-header__text-box">
    <p class="form-dialog-header__text-box__text">
      {{ data.id == "add" ? "Add" : "Edit" }} MELIA
    </p>
  </div>

  <div class="form-dialog-header__icon-box">
    <button class="form-dialog-header__icon-box__btn" (click)="onCloseDialog()">
      <mat-icon class="form-dialog-header__icon-box__icon-size">
        <img
          class="form-dialog-header__icon-box__icon-size__icon"
          src="../../../assets/shared-image/Vector-close.svg"
          alt="~/Frontend/images/icon _ Vector-close"
        />
      </mat-icon>
    </button>
  </div>
</div>

<div class="form-dialog-conten-box-1">
  <mat-dialog-content>
    <form [formGroup]="meliaForm" class="form-dialog-content">
      <!-- //Type of MELIA study or activity  filed----- -->
      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >Type of MELIA study or activity<span class="star"
              >*</span
            ></mat-label
          >
        </div>

        <mat-form-field
          class="form-dialog-content__field"
          floatLabel="always"
          hideRequiredMarker
          appearance="outline"
        >
          <mat-select
            class="select-text"
            required
            formControlName="melia_type"
            (selectionChange)="fillResultsSelect()"
          >
            <mat-option
              *ngFor="let meliaType of meliaTypes"
              [value]="meliaType.id"
            >
              {{ meliaType.name }}
              <app-popover>
                {{ meliaType.description }}
              </app-popover>
            </mat-option>
          </mat-select>

          <mat-error
            class="error"
            *ngIf="meliaForm.controls?.['melia_type']?.errors?.['required']"
            >This field is mandatory</mat-error
          >
        </mat-form-field>
      </div>

      <!-- //Methodology applied filed----- -->

      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >Methodology applied<span class="star">*</span>
            <app-popover  id="6"></app-popover
          ></mat-label>
        </div>

        <mat-form-field
          class="form-dialog-content__field"
          floatLabel="always"
          hideRequiredMarker
          appearance="outline"
        >
          <textarea
            required
            class="texta"
            cdkAutosizeMinRows="2"
            cdkAutosizeMaxRows="10"
            matInput
            formControlName="methodology"
          >
          </textarea>
          <mat-error
            class="error"
            *ngIf="meliaForm.controls?.['methodology']?.errors?.['required']"
            >This field is mandatory</mat-error
          >
        </mat-form-field>
      </div>

      <div class="form-dialog-content__field--grid-column">
        <div class="risk-report-radio-buttons-flex-box">
          <mat-radio-group
            formControlName="experimental"
            aria-label="Select an option"
            color="primary"
          >
            <mat-radio-button [value]="true">Experimental</mat-radio-button>
            <mat-radio-button [value]="false"
              >Non-experimental</mat-radio-button
            >
          </mat-radio-group>
          <app-popover top="0px"  id="7"></app-popover>
          <!-- <mat-error
            class="error"
            *ngIf="meliaForm.controls?.['experimental']?.errors?.['required']"
            >Experimental is required</mat-error
          > -->
        </div>
      </div>

      <!-- //Tools and template (questionnaires) filed----- -->

      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >Tools and template (questionnaires)<span class="star">*</span>
            <app-popover  id="8"></app-popover>
          </mat-label>
        </div>

        <mat-form-field
          class="form-dialog-content__field textarea-m-b"
          floatLabel="always"
          hideRequiredMarker
          appearance="outline"
        >
          <textarea
            required
            class="texta"
            cdkAutosizeMinRows="2"
            cdkAutosizeMaxRows="10"
            matInput
            formControlName="questionnaires"
          >
          </textarea>
          <mat-error
            class="error"
            *ngIf="meliaForm.controls?.['questionnaires']?.errors?.['required']"
            >This field is mandatory</mat-error
          >
        </mat-form-field>
      </div>

      <!-- //Anticipated year of completion filed----- -->
      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >Anticipated year of completion<span class="star">*</span>
            <app-popover  id="9"></app-popover>
          </mat-label>
        </div>

        <mat-form-field
          class="form-dialog-content__field"
          floatLabel="always"
          hideRequiredMarker
          appearance="outline"
        >
          <mat-select
            class="select-text"
            required
            formControlName="completion_year"
          >
            <mat-option
              *ngFor="let anticipatedYear of AnticipatedYear"
              [value]="anticipatedYear.month + ' - ' + anticipatedYear.year"
            >
              {{ anticipatedYear.month + " - " + anticipatedYear.year }}
            </mat-option>
          </mat-select>
          <mat-error
            class="error"
            *ngIf="meliaForm.controls?.['completion_year']?.errors?.['required']"
            >This field is mandatory</mat-error
          >
        </mat-form-field>
      </div>

      <!-- //Tools and template (questionnaires) filed----- -->

      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >How the MELIA study or activity will inform management decisions
            and contribute to internal learning<span class="star">*</span>
            <app-popover  id="10"></app-popover>
          </mat-label>
        </div>

        <mat-form-field
          class="form-dialog-content__field textarea-m-b"
          floatLabel="always"
          hideRequiredMarker
          appearance="outline"
        >
          <textarea
            required
            class="texta"
            cdkAutosizeMinRows="2"
            cdkAutosizeMaxRows="10"
            matInput
            formControlName="management_decisions"
          >
          </textarea>
          <mat-error
            class="error"
            *ngIf="meliaForm.controls?.['management_decisions']?.errors?.['required']"
            >This field is mandatory</mat-error
          >
        </mat-form-field>
      </div>

      <!-- //Other Initiatives filed----- -->
      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >Other Initiatives<span class="star">*</span>
            <app-popover  id="11"></app-popover>
          </mat-label>
        </div>

        <mat-form-field
          class="form-dialog-content__field"
          floatLabel="always"
          hideRequiredMarker
          appearance="outline"
        >
          <mat-select
            class="select-text"
            required
            formControlName="other_initiatives"
            multiple
            [compareWith]="compareId"
          >
            <!-- //////////////////////////////////////////////// -->

            <mat-select-trigger>
              <mat-chip-listbox>
                <mat-chip
                  *ngFor="let initiative of meliaForm?.value?.other_initiatives"
                  [removable]="true"
                  (removed)="onToppingRemoved(initiative)"
                >
                  <strong class="official-color">{{
                    initiative.official_code
                  }}</strong>
                  - {{ initiative.name }}
                  <mat-icon matChipRemove>cancel</mat-icon>
                </mat-chip>
              </mat-chip-listbox>
            </mat-select-trigger>

            <ng-container *ngFor="let initiative of initiatives">
              <mat-option
                class="w"
                required
                *ngIf="initiative.id != data?.initiative_id"
                [value]="initiative"
              >
                <strong class="official-color">{{
                  initiative.official_code
                }}</strong>
                - {{ initiative.name }}
              </mat-option>
            </ng-container>
          </mat-select>

          <mat-error
            class="error"
            *ngIf="meliaForm?.errors?.['otherInitiativesRequired'] && showerror"
            >This field is mandatory</mat-error
          >
        </mat-form-field>
      </div>

      <!-- //MELIA Study contributes to filed----- -->
      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >MELIA Study contributes to<span class="star">*</span>
            <app-popover  id="12"></app-popover>
          </mat-label>
        </div>

        <ng-select
          class="select-text"
          [items]="results"
          formControlName="contribution_results"
          placeholder="MELIA Study contributes to"
          bindLabel="title"
          bindValue="id"
          [multiple]="true"
          appearance="outline"
          required
          (change)="resultSelected()"
        >
        </ng-select>

        <mat-error
          class="error"
          *ngIf="meliaForm?.errors?.['contributionResultsRequired'] && showerror"
          >This field is mandatory</mat-error
        >
      </div>

      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >Partners<span class="star">*</span>
            <app-popover  id="13"></app-popover>
          </mat-label>
        </div>

        <ng-select
          required
          class="select-text"
          [items]="partners | async"
          formControlName="partners"
          placeholder="Partners"
          bindLabel="name"
          [minTermLength]="2"
          typeToSearchText="Please enter 2 or more characters"
          [loading]="partnersLoading"
          [typeahead]="partnersInput"
          [multiple]="true"
          appearance="outline"
          [compareWith]="compareCode"
        >
          <div class="t-box select-text">
            <ng-template
              required
              ng-option-tmp
              let-item="item"
              let-search="searchTerm"
              let-index="index"
              class="select-text"
            >
              <div class="ng-select-option">
                <span class="select-text">{{ item.name }}</span>
                <span class="select-text" *ngIf="item.acronym">
                  - {{ item.acronym }}</span
                >
              </div>
            </ng-template>
          </div>
        </ng-select>

        <mat-error
          class="error"
          *ngIf="meliaForm?.errors?.['partnersRequired'] && showerror"
          >This field is mandatory</mat-error
        >

        <!-- <mat-error
          class="error"
          *ngIf="meliaForm.controls?.['partners']?.errors?.['required']"
          >This field is mandatory</mat-error
        > -->
      </div>

      <div class="form-dialog-content__field--grid-column">
        <div class="form-dialog-content__title-box">
          <mat-label class="form-dialog-content__title-box__title"
            >Geographic scope<span class="star">*</span>
            <app-popover  id="14"></app-popover>
          </mat-label>
        </div>
        <div class="risk-report-radio-buttons-flex-box-2">
          <mat-radio-group
            formControlName="geo_scope"
            aria-label="Geographic scope"
            color="primary"
            required
          >
            <mat-radio-button value="global">Global</mat-radio-button>
            <mat-radio-button value="region">Region</mat-radio-button>

            <mat-error
              class="error"
              *ngIf="meliaForm?.errors?.['geographicScopeRequired'] && showerror"
              >This field is mandatory</mat-error
            >
          </mat-radio-group>
        </div>
      </div>

      <div *ngIf="meliaForm.value.geo_scope == 'region'" class="ng-select-box">
        <div class="form-dialog-content__field--grid-column">
          <div class="form-dialog-content__title-box">
            <mat-label class="form-dialog-content__title-box__title"
              >Regions of the main initiative<span class="star"
                >*</span
              ></mat-label
            >
          </div>
          <ng-select
            class="select-text"
            [items]="regions"
            formControlName="initiative_regions"
            placeholder="Regions of the main initiative"
            bindLabel="name"
            [multiple]="true"
            appearance="outline"
            (change)="loadInitCountries()"
            [compareWith]="compareUmCode"
          >
          </ng-select>
          <mat-error
            class="error"
            *ngIf="meliaForm?.errors?.['initiativeRegionsRequired'] && showerror "
            >This field is mandatory</mat-error
          >
        </div>

        <div
          class="form-dialog-content__field--grid-column"
          *ngIf="
            meliaForm.value.initiative_regions &&
            meliaForm.value.initiative_regions.length
          "
        >
          <div class="form-dialog-content__title-box">
            <mat-label class="form-dialog-content__title-box__title"
              >Countries of the main initiative<span class="star"
                >*</span
              ></mat-label
            >
          </div>
          <ng-select
            class="select-text"
            [items]="initCountries"
            formControlName="initiative_countries"
            placeholder="Countries of the main initiative"
            bindLabel="name"
            [multiple]="true"
            appearance="outline"
            [compareWith]="compareCode"
          >
          </ng-select>
          <mat-error
            class="error"
            *ngIf="meliaForm?.errors?.['initiativeCountriesRequired'] && showerror"
            >This field is mandatory</mat-error
          >
        </div>

        <div class="form-dialog-content__field--grid-column">
          <div class="form-dialog-content__title-box">
            <mat-label class="form-dialog-content__title-box__title"
              >Regions of the co-initiative<span class="star"
                >*</span
              ></mat-label
            >
          </div>
          <ng-select
            class="select-text"
            [items]="regions"
            formControlName="co_initiative_regions"
            placeholder="Regions of the co-initiative"
            bindLabel="name"
            [multiple]="true"
            appearance="outline"
            (change)="loadCoInitCountries()"
            [compareWith]="compareUmCode"
          >
          </ng-select>
          <mat-error
            class="error"
            *ngIf="meliaForm?.errors?.['coInitiativeRegionsRequired'] && showerror"
            >This field is mandatory</mat-error
          >
        </div>

        <div
          class="form-dialog-content__field--grid-column"
          *ngIf="
            meliaForm.value.co_initiative_regions &&
            meliaForm.value.co_initiative_regions.length
          "
        >
          <div class="form-dialog-content__title-box">
            <mat-label class="form-dialog-content__title-box__title"
              >Countries of the co-initiative<span class="star"
                >*</span
              ></mat-label
            >
          </div>
          <ng-select
            class="select-text"
            [items]="coInitCountries"
            formControlName="co_initiative_countries"
            placeholder="Countries of the co-initiative"
            bindLabel="name"
            [multiple]="true"
            appearance="outline"
            [compareWith]="compareCode"
          >
          </ng-select>
          <mat-error
            class="error"
            *ngIf="meliaForm?.errors?.['coInitiativeCountriesRequired'] && showerror"
            >This field is mandatory</mat-error
          >
        </div>
      </div>

      <div>
        <div class="form-dialog-conten-button-box">
          <div class="form-dialog-conten__button-box m-t" align="end">
            <!-- <button mat-button mat-dialog-close>Cancel</button> -->
            <div class="risk-report-button-box">
              <button
                class="risk-report-button-box__btn btn--animated btn--chestnut btn"
                type="submit"
                mat-raised-button
                mat-button
                color="primary"
                (click)="submit()"
                cdkFocusInitial
              >
                <mat-icon
                  *ngIf="data.id === 'add'; else edit"
                  class="create-risk-2"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="13"
                    height="13"
                    viewBox="0 0 13 13"
                    fill="none"
                  >
                    <path
                      d="M11.5556 0H1.44444C0.642778 0 0 0.65 0 1.44444V11.5556C0 12.35 0.642778 13 1.44444 13H11.5556C12.35 13 13 12.35 13 11.5556V1.44444C13 0.65 12.35 0 11.5556 0ZM11.5556 11.5556H1.44444V1.44444H11.5556V11.5556ZM5.77778 10.1111H7.22222V7.22222H10.1111V5.77778H7.22222V2.88889H5.77778V5.77778H2.88889V7.22222H5.77778V10.1111Z"
                      fill="white"
                    />
                  </svg>
                </mat-icon>
                <ng-template #edit>
                  <mat-icon class="create-risk">
                    <span class="material-symbols-outlined"> edit_note </span>
                  </mat-icon>
                </ng-template>
                {{ data.id === "add" ? "Add" : "Edit" }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </mat-dialog-content>
</div>
